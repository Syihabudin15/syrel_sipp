// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum EDapemStatus {
  DRAFT
  CANCEL
  PENDING
  PROCCESS
  APPROVED
  REJECTED
  PAID_OFF
}

enum ESubmissionStatus {
  PENDING
  APPROVED
  REJECTED
}

enum EMarginType {
  FLAT
  ANUITAS
}

enum EMarriageStatus {
  KAWIN
  BELUM_KAWIN
  JANDA
  DUDA
}

enum EDocStatus {
  UNIT
  DELIVERY
  PUSAT
  MITRA
}

enum ESettleStatus {
  MENINGGAL
  TOPUP
  LEPAS
  JATUHTEMPO
}

model Role {
  id         String @id @default(uuid())
  name       String @unique
  permission String @db.Text

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  User       User[]
}

model Sumdan {
  id          String    @id @default(uuid())
  name        String
  code        String
  description String?   @db.Text
  logo        String?
  address     String?   @db.Text
  phone       String?
  email       String?
  tbo         Int       @default(3)
  rounded     Int       @default(1000)
  limit       BigInt    @default(0)
  c_margin    Float
  c_adm       Float
  c_gov       Int
  c_stamps    Int
  c_account   Int
  dsr         Float
  sk_no       String?
  sk_date     DateTime?

  status           Boolean            @default(true)
  created_at       DateTime           @default(now())
  updated_at       DateTime           @default(now())
  User             User[]
  ProdukPembiayaan ProdukPembiayaan[]
  droppings        Dropping[]
  berkas           Berkas[]
  jaminans         Jaminan[]
}

model Area {
  id         String   @id @default(uuid())
  name       String
  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  Cabang     Cabang[]
}

model Cabang {
  id      String  @id @default(uuid())
  name    String
  address String? @db.Text
  phone   String?
  Area    Area    @relation(fields: [areaId], references: [id])

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  areaId     String
  User       User[]
}

model User {
  id          String    @id @default(uuid())
  nip         String?
  fullname    String
  username    String    @unique
  password    String
  email       String?
  phone       String?
  target      Int       @default(0)
  position    String?
  pkwt_status String?
  start_pkwt  DateTime?
  end_pkwt    DateTime?
  nik         String?
  salary      Int       @default(0)
  t_transport Int       @default(0)
  t_position  Int       @default(0)
  ptkp        String?

  status         Boolean         @default(true)
  created_at     DateTime        @default(now())
  updated_at     DateTime        @default(now())
  Role           Role            @relation(fields: [roleId], references: [id])
  Cabang         Cabang          @relation(fields: [cabangId], references: [id])
  Sumdan         Sumdan?         @relation(fields: [sumdanId], references: [id])
  roleId         String
  cabangId       String
  sumdanId       String?
  CreateDDapem   Dapem[]         @relation("CreateDapemRelation")
  AODapem        Dapem[]         @relation("AODapemRelation")
  journalDetails JournalDetail[]
}

model ProdukPembiayaan {
  id          String      @id @default(uuid())
  name        String
  c_margin    Float
  c_adm       Float
  c_insurance Float
  max_tenor   Int
  max_plafond Int
  min_age     Int
  max_age     Int
  max_paid    Int
  margin_type EMarginType

  status     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  Sumdan     Sumdan   @relation(fields: [sumdanId], references: [id])
  sumdanId   String
  Dapem      Dapem[]
}

model JenisPembiayaan {
  id       String @id
  name     String
  c_blokir Int
  c_mutasi Int    @default(0)

  status_takeover Boolean  @default(false)
  status_mutasi   Boolean  @default(false)
  status          Boolean  @default(true)
  created_at      DateTime @default(now())
  updated_at      DateTime @default(now())
  Dapem           Dapem[]
}

model Debitur {
  nopen      String   @unique
  salary     Int
  fullname   String
  nik        String?
  birthdate  DateTime
  birthplace String?
  religion   String?
  address    String
  ward       String?
  district   String?
  city       String?
  province   String?
  pos_code   String?
  npwp       String?
  phone      String?
  education  String?
  gender     String?

  no_skep        String?
  name_skep      String?
  date_skep      DateTime?
  tmt_skep       DateTime?
  rank_skep      String?
  publisher_skep String?
  group_skep     String?
  soul_code      Int?
  job_year       Int?

  pay_office     String?
  start_flagging String?
  end_flagging   String?

  mother_name    String?
  account_name   String?
  account_number String?
  Dapem          Dapem[]
}

model Dapem {
  id              String      @id @default(uuid())
  tenor           Int
  plafond         Int
  c_margin        Float
  c_margin_sumdan Float
  c_adm           Float
  c_adm_sumdan    Float
  c_insurance     Float
  c_gov           Int
  c_stamp         Int
  c_account       Int
  c_mutasi        Int
  c_blokir        Int
  c_takeover      Int
  tbo             Int
  rounded         Int
  margin_type     EMarginType

  takeover_from String?
  takeover_date DateTime?
  mutasi_from   String?
  mutasi_to     String?

  dom_status  Boolean
  address     String
  ward        String
  district    String
  city        String
  province    String?
  pos_code    String?
  geolocation String?

  house_status    String?
  house_year      String?
  job             String?
  job_address     String?
  business        String?
  marriage_status EMarriageStatus @default(BELUM_KAWIN)
  aw_name         String?
  aw_nik          String?
  aw_birthdate    DateTime?
  aw_birthplace   String?
  aw_job          String?
  aw_address      String?
  aw_relate       String?

  f_name    String?
  f_relate  String?
  f_phone   String?
  f_address String?

  dropping_status   EDapemStatus       @default(DRAFT)
  verif_status      ESubmissionStatus?
  verif_desc        String?            @db.Text
  slik_status       ESubmissionStatus?
  slik_desc         String?            @db.Text
  approv_status     ESubmissionStatus?
  approv_desc       String?            @db.Text
  takeover_status   EDapemStatus       @default(DRAFT)
  takeover_desc     String?            @db.Text
  takeover_date_exc DateTime?
  mutasi_status     EDapemStatus       @default(DRAFT)
  mutasi_desc       String?            @db.Text
  mutasi_date_exc   DateTime?
  flagging_status   EDapemStatus       @default(DRAFT)
  flagging_desc     String?            @db.Text
  flagging_date_exc DateTime?
  cash_status       EDapemStatus       @default(DRAFT)
  cash_desc         String?            @db.Text
  document_status   EDocStatus         @default(UNIT)
  document_desc     String?            @db.Text
  guarantee_status  EDocStatus         @default(UNIT)
  guarantee_desc    String?            @db.Text

  used_for      String
  no_contract   String
  date_contract DateTime?

  file_slik       String?
  file_submission String?
  video_interview String?
  video_insurance String?
  file_contract   String?
  file_takeover   String?
  file_mutasi     String?
  file_flagging   String?

  status           Boolean          @default(true)
  created_at       DateTime         @default(now())
  updated_at       DateTime         @default(now())
  Debitur          Debitur          @relation(fields: [nopen], references: [nopen])
  ProdukPembiayaan ProdukPembiayaan @relation(fields: [produkPembiayaanId], references: [id])
  JenisPembiayaan  JenisPembiayaan  @relation(fields: [jenisPembiayaanId], references: [id])
  CreatedBy        User             @relation("CreateDapemRelation", fields: [createdById], references: [id])
  AO               User             @relation("AODapemRelation", fields: [aoId], references: [id])
  Dropping         Dropping?        @relation(fields: [droppingId], references: [id])
  Berkas           Berkas?          @relation(fields: [berkasId], references: [id])
  Jaminan          Jaminan?         @relation(fields: [jaminanId], references: [id])

  nopen              String
  produkPembiayaanId String
  jenisPembiayaanId  String
  createdById        String
  aoId               String
  droppingId         String?
  berkasId           String?
  jaminanId          String?
  Angsuran           Angsuran[]
  Pelunasan          Pelunasan?
}

model Dropping {
  id         String    @id @default(uuid())
  file_sub   String?
  file_proof String?   @db.Text
  status     Boolean
  process_at DateTime?
  created_at DateTime
  Dapem      Dapem[]
  Sumdan     Sumdan    @relation(fields: [sumdanId], references: [id])
  sumdanId   String
}

model Berkas {
  id         String     @id @default(uuid())
  file_sub   String?
  file_proof String?
  status     EDocStatus
  process_at DateTime?
  created_at DateTime
  Dapem      Dapem[]
  Sumdan     Sumdan     @relation(fields: [sumdanId], references: [id])
  sumdanId   String
}

model Jaminan {
  id         String     @id @default(uuid())
  file_sub   String?
  file_proof String?
  status     EDocStatus
  process_at DateTime?
  created_at DateTime
  Dapem      Dapem[]
  Sumdan     Sumdan     @relation(fields: [sumdanId], references: [id])
  sumdanId   String
}

model Pelunasan {
  id               String        @id @default(uuid())
  amount           Int
  amount_sumdan    Int
  desc_sumdan      String?       @db.Text
  penalty          Int
  desc             String?       @db.Text
  file_sub         String?
  guarantee_status EDocStatus    @default(MITRA)
  type             ESettleStatus
  Dapem            Dapem         @relation(fields: [dapemId], references: [id])

  status_paid ESubmissionStatus @default(PENDING)
  process_at  DateTime?
  created_at  DateTime
  dapemId     String            @unique
}

model Angsuran {
  id        String    @id @default(uuid())
  counter   Int
  principal Int
  margin    Int
  date_pay  DateTime
  date_paid DateTime?
  remaining Int
  Dapem     Dapem     @relation(fields: [dapemId], references: [id])
  dapemId   String
}

// AKUNTING
enum AccountType {
  ASSET
  KEWAJIBAN
  MODAL
  PENDAPATAN
  BEBAN
}

model CategoryOfAccount {
  id             String              @id @default(uuid())
  name           String
  type           AccountType
  status         Boolean             @default(true)
  parentId       String?
  Parent         CategoryOfAccount?  @relation("AccountHierarchy", fields: [parentId], references: [id])
  Children       CategoryOfAccount[] @relation("AccountHierarchy")
  JournalDetails JournalDetail[]
}

model JournalEntry {
  id          String   @id @default(uuid())
  date        DateTime
  description String?

  JournalDetails JournalDetail[]
}

model JournalDetail {
  id     String  @id @default(uuid())
  debit  Decimal @default(0) @db.Decimal(18, 2)
  credit Decimal @default(0) @db.Decimal(18, 2)

  JournalEntry        JournalEntry      @relation(fields: [journalEntryId], references: [id])
  CategoryOfAccount   CategoryOfAccount @relation(fields: [categoryOfAccountId], references: [id])
  User                User?             @relation(fields: [userId], references: [id])
  journalEntryId      String
  categoryOfAccountId String
  userId              String?
}
